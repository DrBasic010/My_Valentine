<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { text-align: center; padding-top: 50px; align-items: center; }
        .control-panel { background: white; padding: 40px; border-radius: 15px; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 2px solid var(--primary-color); max-width: 600px; width: 90%; }
        .day-list { list-style: none; padding: 0; margin: 20px 0; text-align: left; }
        .day-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .day-item:last-child { border-bottom: none; }
        .day-info { display: flex; flex-direction: column; }
        .day-name { font-weight: bold; color: var(--primary-color); }
        .day-date { font-size: 0.85rem; color: #666; }
        .toggle-btn { padding: 8px 16px; border: none; border-radius: 20px; color: white; cursor: pointer; font-size: 0.9rem; transition: background 0.3s; min-width: 100px; }
        .btn-on { background-color: #28a745; }
        .btn-off { background-color: #6c757d; }
        .btn-on:hover { background-color: #218838; }
        .btn-off:hover { background-color: #5a6268; }
    </style>
</head>
<body>
    <div class="control-panel">
        <h1>ðŸ”’ Admin Control Panel</h1>
        <p>Manage lock status for Valentine's Week cards.</p>
        
        <ul class="day-list" id="dayList">
            <!-- List items generated by JS -->
        </ul>

        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; align-items: center;">
            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: bold; background: #f8f9fa; padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd;">
                <input type="checkbox" id="autoUnlockCheckbox" onchange="toggleAutoUnlock(this.checked)">
                Auto Unlock by Date
            </label>
            <button class="nav-btn" style="background-color: #dc3545;" onclick="resetAll()">Reset All</button>
            <button class="nav-btn" onclick="window.location.href='index.html'">Back to Home</button>
        </div>
    </div>

    <script>
        const days = [
            { id: 7, name: "Rose Day" },
            { id: 8, name: "Propose Day" },
            { id: 9, name: "Chocolate Day" },
            { id: 10, name: "Teddy Day" },
            { id: 11, name: "Promise Day" },
            { id: 12, name: "Hug Day" },
            { id: 13, name: "Kiss Day" },
            { id: 14, name: "Valentine's Day" }
        ];

        const listContainer = document.getElementById('dayList');

        // REPLACE THIS URL with your actual Google Apps Script Web App URL
        const API_URL = "https://script.google.com/macros/s/AKfycbw__XEPVOk7SpILTfaHf_On_wLtu0MJpWvkm1PPftOwfvG0KRgUUolsm8EfJb7AIqwFJg/exec";

        async function getConfig() {
            try {
                const response = await fetch(API_URL);
                return await response.json();
            } catch (error) {
                console.error("Error fetching config:", error);
                return {};
            }
        }

        async function loadAdminPanel() {
            try {
                const data = await getConfig();

                // Initialize Checkbox
                const autoUnlockCheckbox = document.getElementById('autoUnlockCheckbox');
                if (autoUnlockCheckbox) {
                    autoUnlockCheckbox.checked = data.auto_unlock === true;
                }

                listContainer.innerHTML = '';
                days.forEach(day => {
                    const isUnlocked = day.id === 7 || data[`day${day.id}_unlocked`] === true;

                    const li = document.createElement('li');
                    li.className = 'day-item';
                    li.innerHTML = `
                        <div class="day-info">
                            <span class="day-name">Feb ${day.id}: ${day.name}</span>
                        </div>
                        <button class="toggle-btn ${isUnlocked ? 'btn-on' : 'btn-off'}" onclick="window.toggleDay(${day.id}, ${!isUnlocked})">
                            ${isUnlocked ? 'Unlocked' : 'Locked'}
                        </button>
                    `;
                    listContainer.appendChild(li);
                });
            } catch (error) {
                console.error("Error loading admin:", error);
                listContainer.innerHTML = `<li style="color:red; padding:20px; text-align:center;">Error loading data.<br><small>${error.message}</small></li>`;
            }
        }

        loadAdminPanel();

        // Expose functions to window so HTML onclick works
        window.toggleDay = async (dayId, isChecked) => {
            try {
                const data = await getConfig();
                data[`day${dayId}_unlocked`] = isChecked;
                
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                loadAdminPanel();
            } catch (e) {
                alert("Error updating: " + e.message);
            }
        }

        window.toggleAutoUnlock = async (isChecked) => {
            try {
                const data = await getConfig();
                data.auto_unlock = isChecked;
                
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            } catch (e) {
                alert("Error updating: " + e.message);
                document.getElementById('autoUnlockCheckbox').checked = !isChecked; // Revert
            }
        }

        window.resetAll = async () => {
            if (confirm('Are you sure you want to lock all days?')) {
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({})
                });
                loadAdminPanel();
            }
        }
    </script>
</body>
</html>